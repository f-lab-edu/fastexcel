# 실험 계획서: 다중 스레드 엑셀 쓰기 최적화

## 목적
FastExcel 라이브러리를 사용해 대용량 엑셀 파일(1400만 행, 70개 열, ~5-10GB) 쓰기 성능을 개선하기 위해 큐와 다중 스레드 라이터를 활용한 접근법을 테스트한다. 순차 쓰기의 병목을 해결하고 병렬 처리를 통해 쓰기 속도를 향상시키는 것이 목표다.

## 가설
데이터를 큐에 버퍼링하고, 여러 라이터 스레드가 행/열 인덱스를 지정해 랜덤하게 셀을 업데이트하면, 순차 쓰기 병목이 줄어들고 엑셀 파일 쓰기 속도가 향상될 것이다. 큐 크기 모니터링은 메모리 초과를 방지할 것이다.

## 실험 설계

### 1. 실험 환경
- **라이브러리**: FastExcel (스레드 안전성 확인 필요)
- **언어**: Java
- **테스트 데이터**: 70개 열, 100만 행(약 500MB) 랜덤 데이터 생성
- **하드웨어**: t4g.medium (2 vCPU, 4GB 메모리, EBS gp3)
- **측정 지표**: 쓰기 완료 시간(초), 메모리 사용량(MB), CPU 사용률(%), 엑셀 파일 정확성(행/열 순서 및 데이터 무결성)

### 2. 구현 개요
1. **데이터 생성**: 랜덤 데이터 생성기(70개 열, 문자열/숫자 혼합)로 테스트 데이터 준비.
2. **큐 설정**: ConcurrentLinkedQueue를 사용해 데이터를 버퍼링. 큐 크기 임계값(예: 100,000행) 설정.
3. **다중 스레드 라이터**:
    - 2~5개 라이터 스레드 생성, 각 스레드는 큐에서 데이터를 가져와 FastExcel 워크시트에 셀 단위로 기록.
    - 행/열 인덱스를 지정해 랜덤 쓰기(예: 1행, 1000행 등 순서 무관).
    - FastExcel의 스레드 안전성 확인 후, 필요 시 스레드별 워크시트 할당.
4. **큐 모니터링**:
    - 큐 크기가 임계값 초과 시 데이터 입력 일시 중지.
    - 큐 크기 및 메모리 사용량 로깅.
5. **기존 방식 비교**:
    - 단일 스레드 순차 쓰기(FastExcel 기본 방식)로 동일 데이터 처리 후 시간 비교.

### 3. 실험 절차
1. FastExcel의 스레드 안전성 문서 및 코드 분석(셀 쓰기 메커니즘 확인).
2. 테스트 코드 작성:
    - 데이터 생성 및 큐 입력 모듈.
    - 다중 스레드 라이터 모듈(2, 3, 5개 스레드 케이스별 테스트).
    - 큐 크기 모니터링 및 쓰기 시간/메모리 측정 로직.
3. 100만 행 데이터로 3회 반복 테스트(스레드 수별).
4. 결과 분석:
    - 쓰기 시간(초), 메모리 사용량(GB), 파일 정확성(행/열 순서, 데이터 무결성) 비교.
    - 단일 스레드 대비 성능 개선율 계산.

### 4. 예상 결과
- 다중 스레드 라이터(3~5개) 사용 시 쓰기 시간이 단일 스레드 대비 20~50% 단축 예상.
- 큐 크기 모니터링으로 메모리 사용량이 8GB 이내로 유지될 것으로 기대.
- FastExcel이 스레드 안전하다면, 랜덤 셀 쓰기로 순서 문제 없이 정확한 엑셀 파일 생성 가능.

### 5. 위험 및 완화 전략
- **위험**: FastExcel이 스레드 안전하지 않을 경우, 셀 쓰기 충돌 발생 가능.
    - **완화**: 스레드별 워크시트 생성 또는 동기화 메커니즘(예: ReentrantLock) 추가.
- **위험**: 큐 크기 임계값 설정 오류로 메모리 초과.
    - **완화**: 초기 테스트에서 큐 크기를 10,000~100,000행으로 조정하며 안정성 확인.

### 6. 다음 단계
- 실험 결과가 성공적이면:
    - 1400만 행 데이터로 확장 테스트.